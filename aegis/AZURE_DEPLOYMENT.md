# AEGIS Security Backend - Azure Deployment

This directory contains the necessary files and scripts to deploy the AEGIS Security Backend to Azure Container Instances in Southeast Asia.

## Prerequisites

1. **Azure CLI**: Install and configure Azure CLI
2. **Docker**: Docker must be installed and running
3. **Azure Subscription**: Active Azure subscription with appropriate permissions

## Deployment Files

- `Dockerfile` - Container image definition
- `.dockerignore` - Docker build optimization
- `deploy-azure.sh` - Main deployment script
- `monitor-azure.sh` - Monitoring and status script
- `cleanup-azure.sh` - Resource cleanup script
- `src/main/resources/application-prod.properties` - Production configuration

## Quick Deployment

1. **Ensure you're logged in to Azure**:
   ```bash
   az login
   az account show
   ```

2. **Navigate to the aegis directory**:
   ```bash
   cd /home/uttam/IdeaProjects/aegis
   ```

3. **Run the deployment script**:
   ```bash
   ./deploy-azure.sh
   ```

## What Gets Deployed

### Resource Group: `aegis-security-rg`
- **Location**: Southeast Asia (southeastasia)
- **Resources**:
  - Azure Container Registry (ACR)
  - Azure Container Instance (ACI)
  - Azure Redis Cache

### Container Configuration
- **Image**: Spring Boot application with Java 21
- **CPU**: 2 cores
- **Memory**: 4 GB
- **Port**: 8080
- **Environment**: Production profile

### Services
1. **Container Registry**: `aegissecurityacr.azurecr.io`
2. **Container Instance**: `aegis-backend-api.southeastasia.azurecontainer.io`
3. **Redis Cache**: SSL-enabled, Basic tier

## Environment Variables

The following environment variables are automatically configured:

```bash
SPRING_PROFILES_ACTIVE=prod
REDIS_HOST=aegis-redis.redis.cache.windows.net
REDIS_PORT=6380
REDIS_PASSWORD=<auto-generated>
PORT=8080
CORS_ALLOWED_ORIGINS=https://aegis-portal.azurewebsites.net
```

## Monitoring

### Check deployment status:
```bash
./monitor-azure.sh
```

### View live logs:
```bash
az container logs --resource-group aegis-security-rg --name aegis-backend --follow
```

### Restart container:
```bash
az container restart --resource-group aegis-security-rg --name aegis-backend
```

## API Endpoints

Once deployed, the API will be available at:
- **Base URL**: `http://aegis-backend-api.southeastasia.azurecontainer.io:8080/api`
- **Health Check**: `http://aegis-backend-api.southeastasia.azurecontainer.io:8080/api/actuator/health`

## Security Features

- **Database**: TiDB Cloud MySQL (Southeast Asia)
- **Cache**: Azure Redis Cache with SSL
- **CORS**: Configured for production origins
- **SSL/TLS**: Enabled for Redis connections
- **Environment**: Production optimized settings

## Cost Optimization

- **Container**: Basic tier with minimal resources
- **Redis**: Basic C0 instance
- **Registry**: Basic tier
- **Auto-scaling**: Not enabled (can be added later)

## Cleanup

To remove all deployed resources:
```bash
./cleanup-azure.sh
```

⚠️ **Warning**: This will delete ALL resources in the resource group.

## Troubleshooting

### Common Issues

1. **Build Failures**:
   - Ensure Docker is running
   - Check Dockerfile syntax
   - Verify Java 21 compatibility

2. **Container Start Issues**:
   - Check environment variables
   - Verify database connectivity
   - Review container logs

3. **Redis Connection Issues**:
   - Verify Redis cache is running
   - Check SSL configuration
   - Validate connection strings

### Debug Commands

```bash
# Check container status
az container show --resource-group aegis-security-rg --name aegis-backend

# View detailed logs
az container logs --resource-group aegis-security-rg --name aegis-backend

# Check Redis status
az redis show --name aegis-redis --resource-group aegis-security-rg

# Test connectivity
curl http://aegis-backend-api.southeastasia.azurecontainer.io:8080/api/actuator/health
```

## Production Considerations

1. **Domain Setup**: Configure custom domain with SSL certificate
2. **Load Balancing**: Use Azure Application Gateway for high availability
3. **Monitoring**: Set up Azure Monitor and Application Insights
4. **Backup**: Configure automated database backups
5. **Security**: Implement Azure Key Vault for secrets management
6. **CI/CD**: Set up Azure DevOps or GitHub Actions for automated deployments

## Support

For deployment issues or questions, please refer to:
- [Azure Container Instances Documentation](https://docs.microsoft.com/en-us/azure/container-instances/)
- [Azure Redis Cache Documentation](https://docs.microsoft.com/en-us/azure/azure-cache-for-redis/)
- [Spring Boot on Azure](https://docs.microsoft.com/en-us/azure/developer/java/spring-framework/)
